<div class="columns">

  <div class="column is-quarter">

    <div class="column">

      <p>Viewing: {{selectedTimestamp | amDateFormat:'dddd, MMMM Do YYYY'}}</p>
      <hr>

      <div class="is-flex date-picker-wrapper">
        <button (click)="changeDateRange('-1')">previous day</button>
        <datawhore-date-picker class="is-flex center" date="selectedDate" (onDateRangeChange)="changeDateRange($event)"></datawhore-date-picker>
        <button (click)="changeDateRange('+1')" *ngIf="!nextDayIsFuture()">next day</button>
      </div>

      <hr>
      <div class="is-flex" *ngIf="!isLoadingSpaces">
        <!-- TODO: make drop-counter component -->
        <ul class="is-flex center" class="drop-counter is-flex is-filling center">
          <li *ngFor="let space of dropsBySpace | orderBy:'count'" (click)="toggleSpaceDrops(space.name)" [ngStyle]="{'flex': getDropFlex(space), 'background-color': space.color}"
            class="is-flex" [ngClass]="{'has-hidden-drops': dropsHidden(space.name)}">
            <div class="is-flex-inline">
              <datawhore-space-icon [space]="space.name" [classes]="['is-circle']"></datawhore-space-icon>
              <div>{{space.count}}</div>
            </div>
          </li>

        </ul>

      <div class="button is-loading" *ngIf="isLoadingSpaces">Loading...</div>

      </div>


    </div>
  </div>
  <div class="column is-three-quarters">
    <div class="column" *ngIf="!drops.length && !isLoadingSpaces">

      <div class="button is-loading">Loading...</div>
    </div>
    <div class="column storyline" *ngIf="storyline">
      <!-- TODO: make storyline component -->
      <article class="media">
        <div class="media-left">
          <!-- <datawhore-image-figure [size]="16" [src]="spaceIconImage"></datawhore-image-figure> -->
        </div>
        <div class="media-content">
          <div class="content" [ngSwitch]="hasSegments()">
            <!-- <pre>{{storyline|json}}</pre> -->
            <!-- <p>{{storyData.content.date | amDateFormat:'dddd, MMMM Do YYYY'}} Storyline</p> -->
            <div *ngSwitchCase="false">
              <cite>This day has no segments from moves. Drops will be displayed by timestamp.</cite>

              <!-- TODO: this is duplicated from the cloud.component: make it into a component. include a filter. -->
              <div class="column" *ngIf="storyline.drops">

                <datawhore-drop-atomic *ngFor="let drop of storyline.drops | orderBy:'timestamp':false" [type]="drop.type" [drop]="drop"></datawhore-drop-atomic>

                <hr>

              </div>
              <pre>{{storyline.drops | json}}</pre>

            </div>

            <ul *ngSwitchDefault>
              <li *ngFor="let segment of storyline.segments" [ngSwitch]="segment.type">

                <div class="is-flex-inline" *ngSwitchCase="'place'">

                  <span class="icon is-small">
                    <i class="fa fa-{{(segment.place && segment.place.type === 'unknown') ? 'map-pin' : segment.place.type}}" *ngIf="segment.place"></i>
                  </span> {{(segment.place)?segment.place.name:''}} ({{segment.startTime | amDateFormat:'hh:mma' }} to {{segment.endTime
                  | amDateFormat:'hh:mma' }})
                </div>
                <div class="is-flex-inline" *ngSwitchDefault>
                  <span class="icon is-small">
                    <i class="fa fa-folder"></i>
                  </span> {{segment.type}} ({{segment.startTime | amDateFormat:'hh:mma' }} to {{segment.endTime | amDateFormat:'hh:mma'
                  }})
                </div>

                <ul>
                  <li *ngFor="let ac of segment.activities">
                    was
                    <b>{{ac.activity}}</b> during
                    <b>{{ac.duration | amDuration:'seconds'}}</b> over
                    <em>{{ac.distance}}</em>m
                    <div *ngFor="let drop of segment.drops | orderBy:'timestamp':false">
                      <!-- <div *ngFor="let drop of segment.drops | orderBy:'timestamp':false" [ngClass]="{'is-hidden': !display[drop.space].visible}"> -->
                      <datawhore-drop-atomic [type]="drop.type" [drop]="drop"></datawhore-drop-atomic>
                    </div>

                  </li>
                </ul>

              </li>
            </ul>
          </div>


        </div>
        <div class="media-right">
          <a class="delete is-small" (click)="deleteDrop()"></a>
        </div>
      </article>

    </div>

  </div>
</div>
